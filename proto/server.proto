syntax = "proto3";

import "core.proto";

package server;

message ServerUpdate {
  int64 date = 1;
  int32 seq = 2;
  reserved 3;

  oneof update {
    // Chat updates

    ServerChatUpdateNewMessage new_message = 4;
    ServerChatUpdateEditMessage edit_message = 5;
    ServerChatUpdateDeleteMessages delete_messages = 6;
    ServerChatUpdateDeleteChat delete_chat = 7;
    ServerChatUpdateParticipantDelete participant_delete = 8;

    // Space updates
    ServerSpaceUpdateRemoveMember space_remove_member = 9;
    ServerSpaceUpdateMemberUpdate space_member_update = 12;

    // User bucket updates
    ServerUserUpdateSpaceMemberDelete user_space_member_delete = 10;
    ServerUserUpdateChatParticipantDelete user_chat_participant_delete = 11;
  }
}

// ------------------------------------------------------------
// Chat updates
// ------------------------------------------------------------

// Update for a chat when a message is created
message ServerChatUpdateNewMessage {
  int64 chat_id = 1;
  int64 msg_id = 2;
}

// Update for a chat when a message is edited
message ServerChatUpdateEditMessage {
  int64 chat_id = 1;
  int64 msg_id = 2;
}

// Update for a chat when messages are deleted
message ServerChatUpdateDeleteMessages {
  int64 chat_id = 1;
  repeated int64 msg_ids = 2;
}

// Update for a chat when it is deleted
message ServerChatUpdateDeleteChat { int64 chat_id = 1; }

// Update for a chat when a participant is removed
message ServerChatUpdateParticipantDelete {
  int64 chat_id = 1;
  int64 user_id = 2;
}

// ------------------------------------------------------------
// Space updates
// ------------------------------------------------------------

// Update for a space when a member is removed
message ServerSpaceUpdateRemoveMember {
  int64 space_id = 1;
  int64 user_id = 2;
}

// Update for a space when a member's access/role changes
message ServerSpaceUpdateMemberUpdate { Member member = 1; }

// ------------------------------------------------------------
// User bucket updates
// ------------------------------------------------------------

// Update for a user when they were removed from a space
message ServerUserUpdateSpaceMemberDelete { int64 space_id = 1; }

// Update for a user when they were removed from a chat
message ServerUserUpdateChatParticipantDelete { int64 chat_id = 1; }
